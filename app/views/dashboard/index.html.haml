%script{:type => "text/javascript", :src  => "//maps.google.com/maps/api/js?v=3.13&sensor=false&libraries=geometry"}
%script{:type => "text/javascript", :src  => "//google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js"}

.jumbotron(style="padding: 30 40 40 40;")
  .container
    %h1 Trees Matter
    %p Trees know when there's trouble before we do. Let's help them tell us.
    %p
      %a.btn.btn-primary.btn-lg(role="button" href="pages/why")
        Huh? &raquo;

.container
  .row
    .col-md-6
      #map(style="width: 100%; height: 400px;")
    .col-md-6
      .row
        .col-md-8
          %h2.text-right All OpenTrees:
        .col-md-4
          %h2= @trees.length
      .row
        .col-md-8
          %h2.text-right Nearby OpenTrees:
        .col-md-4
          %h2= @trees.length
          .space-40

      .row
        .col-md-12
          %table.table
            %thead
              %tr
                %th Tree
                %th Taken
                %th By
            %tbody
              - @trees.each do |tree|
                %tr
                  %td
                    %a{:href => ("/trees/#{tree.id}")}
                      = tree.title
                  %td= tree.datetaken
                  %td
                    %a{:href => (flickr_user_url tree.owner)}
                      = tree.ownername

:javascript
  var handler = Gmaps.build('Google');
  handler.buildMap({internal: {id: 'map'}}, function() {
    if (navigator.geolocation)
      navigator.geolocation.getCurrentPosition(displayOnMap);
  });

  function displayOnMap(position) {
    markers = handler.addMarkers(#{raw @marker_hash.to_json})
    var marker = handler.addMarkers(markers);
    handler.bounds.extendWith(markers);
    handler.fitMapToBounds();
  }